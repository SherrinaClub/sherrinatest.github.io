基于微信小程序的校园导航系统设计与实现
摘 要
近年来，我国不断加强高校建设，但随着高校校园面积的扩展，校园内跨区域的活动趋于频繁。为了让校内师生与校外人士在教学、生活、办公等方面更为方便，以及应对校园数字化建设的需求，有必要设计和开发具有本校特色的校园导航系统。同时，各大地图运营商纷纷提供了自己的API，使得开发导航系统的技术门槛得到了前所未有的降低。
根据近年来导航系统的现状以及中国海洋大学崂山校区的实际情况，本校园导航系统选择了以微信小程序为前端、新浪 SAE为后台，结合高德地图 API来完成核心设计与开发。系统以现有导航系统为基础，结合崂山校区实际，实现了选择查询、输入查询、路线导航等功能模块，建设了易开发、易维护、低成本的应用系统，使客户端的开发以及对数据库的操作更为便捷化。
本文首先对开发针对本校的校园导航系统的意义进行了讨论，接着介绍了微信小程序以及在开发过程中所要用到的高德地图API与新浪云应用平台。随后，针对本系统进行了需求分析，提出了设计思路，进行了基础界面设计。接着，在实现方面对系统的界面设计以及程序设计进行了详细的介绍，并对系统的功能进行了测试。最后，对毕业设计的整个过程进行了总结与展望。
关键词 数字学园 校园导航 微信小程序 高德地图 新浪云应用
Design and implementation of Campus navigation system Based on WeChat Mini-Program
Abstract
In recent years， China has been strengthening the construction of colleges and universities， but with the expansion of campus area， there are more and more difficult to find your destination. In order to make it easier for the teachers and students of the school to teach， to live and to work in the university， it’ s necessary to design and develop a campus navigation system with the special feature of university. At the same time， the major map operators have provided their own API， making the development of navigation system technology threshold has never been lower.
According to the current situation of the navigation system in recent years and the actual situation of the Laoshan campus of OUC， this campus navigation system choose WeChat Mini- Program as the front end， Sina App Engine as the background， combined with Gaode Maps API to complete the design and development of the core. This system based on the existing navigation system， combining the reality of the Laoshan campus， implements selecting the destination， searching the destination， and route navigation function modules.
Key words：Digital School， Campus navigation system， WeChat Mini-Program， Gaode Map， Sina App Engine.
目 录
摘 要I
AbstractII
目 录III
1 绪论5
1.1 课题的来源、目的和意义5
1.2国内外校园导航的研究现状5
1.2.1 国内研究现状6
1.2.2 国外研究现状7
1.3 研究内容与组织结构8
1.4 本章小结8
2 校园导航系统相关技术9
2.1 微信小程序9
2.2 高德地图API10
2.3 新浪云应用平台10
2.3 本章小结10
3 校园导航系统设计10
3.1 需求分析11
3.1.1 用户需求11
3.1.2 功能需求11
3.1.3 性能需求12
3.2 界面设计12
4 校园导航系统具体实现14
4.1 界面设计14
4.1.1 主界面14
4.1.2 选择目的地15
4.1.3 输入目的地16
4.1.4 地图19
4.1.5 路径详情20
4.2 功能实现21
4.2.1 查询目标地点21
4.2.2 确定位置和规划路径24
4.3 系统测试28
4.4 本章小结33
5 总结与展望34
5.1 论文总结34
5.2 论文展望34
参考文献36
致谢38
1 绪论
1.1 课题的来源、目的和意义
中国海洋大学崂山校区位于崂山区松岭路238号，坐落于崂山风景区脚下，建成于2005年，是海大的主校区。随着近些年来的整修和扩建，崂山校区的各个院系和机构的分布趋于复杂。招收学生的增加，也使得来访学校的人员也越来越多，来访者需要经历很大的周折才能到达目的地。在校门口分发纸质地图虽然可行，但纸质地图查阅起来不够直观，而且大量印刷地图，显然需要耗费不必要的经费。因此，提供电子校园导航服务，对提高高校现代化建设具有很好的价值。同时，也可为其他校区或是其他高校的相似需求提供一个很好的例子。
随着移动技术的发展，手机已成为人们出行在外必不可少的随身用品。作为集通信、查询、娱乐等功能于一体的移动计算工具，人们赋予手机的功能也越多。传统计算机中的导航系统早已能在安卓、 IOS等平台上实现，导航软件因其与移动设备的高契合度与强相关性，而成为了智能手机应用中的热点之一。在这个大背景下，腾讯近年所推出的微信小程序，更是吸引了很多用户以及开发者的目光。微信小程序是一种全新的连接用户与服务的方式，它可以在微信内被便捷地获取和传播，同时具有出色的使用体验。基于微信的技术文档分析，微信小程序能覆盖大部分的APP常用功能。同时，又具有无需安装、随用随点、跨平台开发、组件和API丰富等优势。针对校园导航的需求，用微信小程序来实现是一个不错的选择。
如今，全球定位系统与最初相比有了很大飞跃，精度越来越准确，已经基本能够满足较大范围之内的导航服务。但是，基于GPS的导航对于周围环境的要求较为严格，在局部小环境下，如果没有添加道路消息以及建筑物的标注，导航系统就无法发挥很好的作用。可以在GPS的基础上，实现针对校园内各个院系和机构中目标地点的导航及搜索导航。
1.2国内外校园导航的研究现状
关于校园导航技术，目前主要有三种实现方式：一是利用工程制图软件，二是利用GIS技术，三是利用校园电子地图。
（1）校园导航模型由建筑物和建筑物之间的路径构成，因此可以用数据结构中的图来模拟。用图的结点代表目标地点，用图的边代表目标地点之间的路径。结点值代表目标地点的信息，边的权值代表目标地点间的距离。结点值及边的权值用顺序表存储，需要设计一个顺序表类。要求目标地点之间的路线，可以给每个目标地点一个代码，用结构体类型实现。计算路径长度和最短路线时可用狄杰斯特拉（Dijkastra）算法实现。
（2）关于现存地理信息系统的研究归纳概括起来有二种情况：一是利用GIS系统处理用户数据；二是在GIS的基础上，二次开发出用户的专用的地理信息系统。在美国及发达国家，地理信息系统的应用遍及环境保护、资源保护、灾害预测、投资评价、城市规划建设、政府管理等众多领域。近年来，我国经济建设迅速发展，地理信息系统在城市规划管理、交通运输、测绘、环保、农业、制图等领域发挥了重要的作用，取得了良好的经济效益和社会效益。
（3）电子地图可以利用卫星地图对校园地理信息进行非常准确的描述。通过获取校园的相关建筑数据以及地理环境信息，对相关信息进行提取，建立校园二维平面图。通过对校区真实场景转换到三维虚拟场景的引擎构建，实现三维校园的虚拟漫游和智能导航。
1.2.1 国内研究现状
校园导航系统实际是虚拟现实(Virtual reality，简称VR)技术与地理信息系统技术的相结合。虚拟现实技术是在上世纪80年代初由美国人拉尼尔提出，这种技术通过计算机产生与现实一样的虚拟环境，以三维视觉画面为主，兼具听觉、触觉甚至于嗅觉的人工环境。地理信息系统( GIS)是结合地理学与地图学，用于输入、存储、查询、分析和显示地理数据的计算机系统，它主要的功能是能够提供多种空间和动态的地理信息。
美国是VR技术的发源地，其虚拟现实研究技术在国际上处于最高水平。而且应用的领域十分广泛，特别是在军事、航天、医疗、汽车生产和建筑上的应用尤为突出。美国高校也是 VR技术研究的活跃地带，各所大学在 VR技术上各具特色，比如美国北卡罗来纳大学应用 VR技术从事航天驾驶、外科手术仿真、建筑仿真方面的研究。英国、德国、荷兰等欧洲一些比较发达的国家对 VR技术的研究也是比较深入的，而处于领先地位应属英国，特别是在分布并行处理、辅助设备设计和应用研究等方面。
日本在使用VR技术的研究与开发方面领先于其他亚洲国家。VR专用设备已大量推向市场，日本一些公司已经把VR技术商品化，大学研究所的VR研究更深入、更广泛。东京大学的原岛研究室开展了人类面部表情特征的提取、三维结构的判定和三维形状的表示、动态图像的提取这三方面的研究。东京大学广濑研究室在飞行仿真器模拟真实座舱、真人连接一个传感器运动能够在计算机显示虚拟人体随动等方面的研究令人赞叹。除此之外，东京技术学院、筑波大学等高等学校在VR技术方面都有较深入的研究。
1.2.2 国外研究现状
我国的VR技术研究开始于上世纪90年代，比起欧美发达国家仍有较大的差距。但由于VR技术在社会各领域的应用有着美好的前景，社会各界也对VR技术引起高度关注，并积极投身研究和应用。在高等教育领域，国内一些重点院校在VR技术上也取得了一定的研究成果。清华大学、浙江大学、北京航空航天大学等高校都建立了进行虚拟现实研究的实验室，在国防安全、智慧城市、装备制造等领域发挥了重要的作用。这些高校研究机构还与美国、德国、英国、法国、日本等国外相关研究机构开展了广泛的学术合作和交流，产生了较大的国际学术影响。
在校园导航系统研究方面，不少高校根据自身技术能力和条件进行了研究，采用的技术和开发平台各有特色，但由于相关的技术比较薄弱，开发出来的产品技术含量低，且疏于系统管理，缺乏应用性，但校园导航系统的研究还是不断在发展。有的高校则依托校外专业技术公司设计开发校园导航系统，不仅界面友好，而且功能强大，受到师生的欢迎。但这种由专业公司打造出来的校园导航系统无疑需要庞大的资金投入，并不适用于所有高校。有条件的学校可依靠校内各方的资源和技术，共同开发适合自身的校园导航系统。这样更为实际。
1.3 研究内容与组织结构
第一章为绪论。本章介绍了校园导航系统的课题来源、目的和意义，介绍了国内外关于校园导航系统的研究现状，并且阐述了论文的研究内容和组织结构。
第二章为校园导航系统的相关技术。本章介绍了完成该系统所要使用到的主要技术和工具。针对校园导航系统，从实现的角度来看，前端用微信小程序，后台使用新浪云应用平台，路径规划功能则使用高德地图 API所提供的相关接口来完成。
第三章为校园导航系统的需求分析。本章分析了系统的用户需求，并根据系统的目标确定了系统的功能需求和性能需求，并对跟根据系统需求对界面进行了简单的设计。
第四章为校园导向系统的具体实现。本章对系统的界面进行了详细设计，并从代码的角度实现了系统的核心功能，最后对这些功能进行了测试。
第五章为总结与展望。本部分对本次毕业设计进行了总结，分析了系统的不足之处，并对可以进行的下一步工作进行了展望。
1.4 本章小结
本章主要介绍了本课题的研究背景、意义和目标，说明当今高校对校园导航系统的需求以及该系统的必要性。另外，对本文的组织结构进行了划分，使得本文的条理更为清晰。
2 校园导航系统相关技术
2.1 微信小程序
当今APP主要分为原生APP和Web APP两种，原生APP最大的优势就是对于系统控件接口和框架的调用能力要优于Web APP。此前，很多创业者已经通过在公众号菜单栏内嵌HTML5的方式实现了基础功能的微信植入，但通过这种方法无法预期较高的操作体验。微信小程序是一种可以在不下载的情况下使用的应用程序，最大的亮点在于微信提供了界面、视图、内容、按钮、导航、多媒体、位置、数据、网络、重力感应等丰富的框架组件和 API接口供开发者调用。有了这些组件和接口，微信小程序的流畅度便可以保持和原生APP一样的体验。基于微信的技术文档分析，微信小程序可以覆盖大部分APP的常用功能。这里通过SWOT分析来对微信小程序的优缺点进行分析。
图2-1 微信小程序SWOT分析
微信小程序开发主要采用 WXML（ HTML5）、 WXSS（ CSS）、 JavaScript技术，使用数据绑定渲染的思路，通过 JS调用微信提供的控件和接口实现服务器交互等操作。关于小程序账号的注册步骤以及小程序开发工具的使用方法，微信给出的官方文档中已有详细说明，本文不再加以赘述。
2.2 高德地图API
高德地图的 API是高德软件有限公司对开发者免费开放的应用程序接口，它包括微信小程序 SDK，可以在微信小程序中获取高德语丰富的地址描述、 POI和实时天气数据。在高德提供的微信小程序 SDK中包含了各种接口，可以通过调用函数的方法来实现相应的功能，比如用户可以利用 getPoiAround来检索周边的 POI（ Point of Interest）， getWeather来查询天气等。高德地图开发包所提供的库能够很方便地实现很多函数。本系统主要利用其中的路线规划函数，来实现崂山校区内的导航。
2.3 新浪云应用平台
新浪应用云平台Sina App Engine（简称SAE）是由新浪公司开发和运营的开放云计算平台的核心组成部分，是国内第一家公有云计算平台。供开发者创建应用时采用。开发者可以使用 SAE开发托管应用，省去了很多麻烦，建站者可以使用 SAE托管网站程序，新浪云平台从架构上采用分层设计，从上往下分别为反向代理层、路由逻辑层、 Web计算服务池、日志和统计中心还有各种分布式服务。新浪 SAE数据库缓存服务中的共享型 MySQL是基于 MySQL5.6开发的共享数据库服务，仅需几秒钟即可获得一个包括主从节点、高可用服务、自动备份、在线扩容以及监控等各种管理功能的 MySQL服务。本系统将存储了校内地点名称与经纬度的数据库以及对数据库内的数据进行查询的后台php文件存放在新浪SAE平台上。
2.3 本章小结
本章主要介绍了实现校园导航系统时所要使用到的相关技术与工具。微信小程序一种全新的连接用户与服务的方式，它可以在微信内被便捷地获取和传播，同时具有出色的使用体验和无需安装、随用随点、跨平台等优势。针对校园导航的需求，将微信小程序结合高德地图较为成熟的路径规划技术，将新浪SAE作为后台来实现是一个不错的选择。
3 校园导航系统设计
3.1 需求分析
3.1.1 用户需求
目前，我们可以通过各种途径接触到导航系统，例如以网页形式的电子地图，如Google地图、百度地图、高德地图等；以GPS导航为核心的电子地图，如城际通、纽曼、新科等；还有通过手机导航功能实现的电子地图，导航功能已经成为智能手机的必备功能。对此，本系统选择采用“随用随开”的微信小程序作为开发平台，不仅成本较为低廉，而且在现在几乎人手一台手机的背景下，以微信小程序作为平台也在便利程度上有着很大的优势。
本系统作为导航系统，用户使用的主要目的是确定当前位置与目的地位置，以及前往目的地的最佳路径。针对这两点，本系统针对用户需求，将目的地查询和路径规划作为核心功能。
3.1.2 功能需求
本系统用于用户在海大崂山校区时通过手机使用微信小程序，来定位用户的当前位置，查询用户给出的目标地点的位置，以及任意两个目标地点之间的最优路径，同时提供详细带路信息。业务流程图如图所示：
图3-1 校园导航系统业务流程图
1.主界面：用户查询目的地时，提供选择目的地与输入目的地两种输入方式。
2.选择目的地：将崂山校区的目标地点分为教学楼、学院楼和其他地点三类，方便用户查询。
3.输入目的地：用户在搜索框中输入目标地点名称，系统在数据库中查询，
4.地图界面：默认始发地为当前位置，可以手动输入的方式更改始发地和目的地，查看对应的两个目标地点之间的最优路径，并在地图上画出。
5.路径详情：显示最优路径的距离以及详细带路信息。
3.1.3 性能需求
微信小程序一般是在手机上运行，在实现时应注意以下几点：
1.用户界面的设计要合理，要做到简洁直观，方便用户操作，同时优化UI；
2.当通过手动输入的方式查询目标地点时，即使没有找到对应结果，也要有提示信息；
3.对于需要长时间处理的请求，要提示用户系统正在运行；
4.在输入界面，相对于更改目的地，更改始发地时要加入“当前位置”的选项。
3.2 界面设计
由功能需求分析可知，小程序启动后，主界面提供两个选项按钮，分别为“选择目的地”按钮和“输入目的地”按钮。用户点击按钮，可以前往对应的页面。
图3-2 主界面设计
在选择目的地页面中，通过顶部导航将页面分为“教学楼”、“学院楼”和“其他”三个部分，用户可以通过点击目的地的名称按钮前往地图界面；在输入目的地页面中，用户可以在搜索框中输入目标地点名称，输入完毕后，搜索框的下方会出现搜索结果，点击搜索出的地点名称，可前往地图页面。
图3-2 选择目的地页面设计
在地图页面中，上方有两行列表项，分别显示始发地和目的地，点击始发地或目的地，可更改相应部分。中间显示地图，地图中心默认为始发地与目的地中点，用户可以滑动或扩大地图。下方显示始发地与目的地之间的路径长度，以及估算的步行时间，右侧是“详情”按钮。点击“详情”按钮，可前往详细带路信息。
图3-3 地图页面设计
4 校园导航系统具体实现
4.1 界面设计
本系统的界面UI借助成熟WeUI实现。 WeUI是一套同微信原生视觉体验一致的基础样式库，由微信官方设计团队为微信内网页和微信小程序量身设计，令用户的使用感知更加统一。以下主要从代码的角度分析主界面以及其他各个界面的实现。
4.3 系统测试
为验证系统实现的功能以及系统的稳定性，需对系统进行全面的测试。在本部分中，主要对系统对目标地点的搜索功能以及导航功能进行了测试。这两部分内容为校园导航系统最核心的功能，这些功能能否成功运行很大程度地决定了系统的可用性。
1.选择搜索功能测试：
以外国语学院为例，点击主界面的“选择目的地”按钮，点击顶部导航栏的“学院楼”选栏，向下滑动页面，点击“外国语学院”按钮，即可进入地图界面。
图4-7 选择搜索测试
2.输入搜索功能测试：
（1）以东宿舍区为例，点击主界面的“输入目的地”按钮，在输入界面的搜索框中输入“东”，搜索结果显示了名称中含有东字的所有地点，点击“东宿舍区”，即可进入地图界面；
图4-8 输入搜索测试
（2）在搜索框中输入数据库中不存在的地点名，搜索结果处显示“暂无搜索结果”；
图4-9 无搜索结果
（3）在地图界面中点击始发地，重新输入新始发地名称，可修改始发地；
图4-10 修改始发地
（4）在地图界面中点击目的地，重新输入新目的地名称，可修改目的地；
图4-11 修改目的地
（5）修改始发地时，点击搜索结果中的“当前位置”，可令始发地返回当前位置；
图4-12 返回当前位置
（6）当输入目的地（或始发地）与当前的始发地（或目的地相同）时，显示弹窗，提示始发地与目的地相同。
图4-13 始发地与目的地相同
3.导航功能测试：
在地图界面中，点击右下方的“详情”按钮，可显示详细带路信息。
图4-14 导航功能测试
4.其他：
当由于网络等原因无法正常连接时，显示提示信息。
图4-14 网络错误
4.4 本章小结
本章详述了整个系统的代码实现，包括各个页面的设计，以及查询目标地点和确定位置、规划路径等校园导航系统核心功能的实现，还对这些功能进行了测试，对运行结果进行了截图。通过测试结果可知，本校园导航系统的核心功能已基本实现。
5 总结与展望
5.1 论文总结
做毕业设计是为了让我们将理论知识与实际操作结合起来，提高分析和解决问题的能力。回首整个开发设计过程，我学到了很多书本上学不到的东西，深深感觉到自己所学知识的有限。在设计过程中，我四处查找资料，不断自学，分析、解决问题，和前辈、同学以及朋友一起交流讨论，希望尽可能地完善自己的毕业设计，但是可惜力有不逮，最后的成品和预想中还存在着一些差距。不过，成果并不是一切，最重要的是我在完成毕业设计中所积累的实际经验，知识不用不会，只有在实践中才能掌握真正的知识和技能。
5.2 论文展望
在本次校园导航系统的设计和实现过程中，受到技术、设备等多因素的影响，系统的许多地方尚待改进。与此同时，校园导航系统也要伴随着校园信息化的发展不断完善。本系统与真正理想的校园导航系统还存在着距离，还有很多需要完善的部分，主要有如下几点：
1.本文的校园导航系统仅实现了查询目标地点以及路径规划的核心功能，与其他类似导航系统相对比，还有欠缺很多外围功能，例如实景图切换和目标地点详细信息查询等等，有待二次开发；
2. 由于时间关系，本系统数据库中存储的目标地点并不全面，还有很多地点未存入数据库。在测试完善系统的过程中，数据有待进一步补充。此外，数据库的安全性以及数据表的结构也有待优化；
3. 可以将校园导航系统嵌入到校园网络中，加强与学校各机构官网、论坛以及其他资源的联系，实现真正的数字化校园。
致谢
在这次毕业设计过程中，感谢各位老师以及前辈给与我的关心与帮助。在设计过程中，各位耐心的指导给与了我很大帮助。通过此次校园导航系统的设计与实现，我与很多拥有实践经验的前辈进行了接触，不仅学习到了很多新的知识，还学习到了锲而不舍的精神和对待实践的严谨态度，使我受益匪浅。借此机会，我要向给予了我莫大帮助和指导的各位老师、关心我的同学们和一路支持我的家人表示深深的感谢与敬意。同时，谨向审稿的老师们表示衷心的感谢！